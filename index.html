<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–£–∫–ª–æ–Ω—è–ª–∫–∞</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: radial-gradient(circle at top, #1b0f3b, #070711);
    color:#fff;
    min-height:100vh;
    overflow:hidden;
}

/* ===== HEADER ===== */
.header{
    text-align:center;
    padding:14px 10px;
}
.header h1{
    font-size:1.4em;
    font-weight:800;
    background:linear-gradient(90deg,#ffd43b,#ff922b);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}
.subtitle{
    font-size:.8em;
    color:#d0bfff;
}

/* ===== GAME CARD ===== */
.game-card{
    background:linear-gradient(180deg,#2b1c5a,#1a103b);
    border-radius:20px;
    padding:12px;
    margin:0 10px;
    box-shadow:
        inset 0 1px 0 rgba(255,255,255,.15),
        0 10px 30px rgba(0,0,0,.6);
}

/* ===== CANVAS ===== */
canvas{
    display:block;
    width:100%;
    border-radius:14px;
    background:#0b0b18;
    box-shadow:inset 0 0 20px rgba(0,0,0,.8);
}

/* ===== STATS ===== */
.stats{
    display:flex;
    gap:8px;
    margin-top:10px;
}
.stat{
    flex:1;
    background:linear-gradient(180deg,#3b2b7a,#24175a);
    border-radius:14px;
    padding:8px 6px;
    text-align:center;
    font-weight:700;
    font-size:.85em;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.15);
}
.stat span{
    display:block;
    margin-top:2px;
    color:#ffd43b;
}

/* ===== CONTROLS ===== */
.controls{
    display:flex;
    gap:10px;
    margin-top:12px;
}
.btn{
    flex:1;
    border:none;
    border-radius:16px;
    padding:14px 0;
    font-size:16px;
    font-weight:800;
    cursor:pointer;
    color:#1a1200;
    background:linear-gradient(180deg,#ffe066,#fab005);
    box-shadow:
        0 6px 0 #d18b00,
        0 12px 20px rgba(0,0,0,.4);
    transition:.1s;
}
.btn:active{
    transform:translateY(4px);
    box-shadow:0 2px 0 #d18b00;
}
.btn.start{
    background:linear-gradient(180deg,#69db7c,#38d9a9);
    box-shadow:
        0 6px 0 #2f9e44,
        0 12px 20px rgba(0,0,0,.4);
}

/* ===== GAME OVER ===== */
.game-over{
    display:none;
    margin-top:10px;
    padding:12px;
    text-align:center;
    border-radius:14px;
    background:linear-gradient(180deg,#5c1a1a,#2b0b0b);
    color:#ffa8a8;
    font-weight:700;
}

/* ===== SAVE ===== */
.save{
    display:none;
    gap:8px;
    margin:10px;
}
.save input{
    flex:1;
    padding:10px;
    border-radius:12px;
    border:none;
    background:#1b143a;
    color:#fff;
}
.save button{
    padding:10px 14px;
    border:none;
    border-radius:12px;
    background:linear-gradient(180deg,#74c0fc,#4dabf7);
    font-weight:700;
}

/* ===== BOTTOM BAR ===== */
.bottom{
    position:fixed;
    bottom:0;left:0;right:0;
    background:linear-gradient(180deg,#1b123f,#0b0620);
    display:flex;
    padding:10px 0;
    border-top:1px solid rgba(255,255,255,.1);
}
.bottom button{
    flex:1;
    background:none;
    border:none;
    color:#c0b3ff;
    font-size:11px;
}
.bottom div{
    font-size:18px;
}
</style>
</head>

<body>

<div class="header">
    <h1>üéÆ –£–∫–ª–æ–Ω—è–ª–∫–∞</h1>
    <div class="subtitle">–ê—Ä–∫–∞–¥–Ω—ã–π —Ä–µ–∂–∏–º</div>
</div>

<div class="game-card">
    <canvas id="gameCanvas"></canvas>

    <div class="stats">
        <div class="stat">üèÜ<span id="currentScore">0</span></div>
        <div class="stat">üéØ<span id="level">1</span></div>
        <div class="stat">‚ö°<span id="speed">3</span></div>
    </div>

    <div class="game-over" id="gameOver">
        üí• –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞<br>
        –°—á—ë—Ç: <span id="finalScore">0</span>
    </div>

    <div class="controls">
        <button class="btn" onclick="moveLeft()">‚óÄ</button>
        <button class="btn start" id="startBtn" onclick="startGame()">START</button>
        <button class="btn" onclick="moveRight()">‚ñ∂</button>
    </div>
</div>

<div class="save" id="saveSection">
    <input id="username" value="–ò–≥—Ä–æ–∫">
    <button onclick="saveScore()">üíæ</button>
</div>

<div class="bottom">
    <button><div>üéÆ</div>–ò–≥—Ä–∞</button>
    <button><div>üìä</div>–°—Ç–∞—Ç—ã</button>
    <button><div>üèÜ</div>–¢–æ–ø</button>
    <button><div>‚öôÔ∏è</div>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</div>

<!-- ===== –¢–í–û–ô JS –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô ===== -->
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.expand();
            tg.MainButton.hide();
        }
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        
        // –†–∞–∑–º–µ—Ä—ã canvas
        canvas.width = Math.min(window.innerWidth - 20, 500);
        canvas.height = canvas.width * 0.65;
        
        let gameRunning = false;
        let score = 0;
        let level = 1;
        let player = {
            x: canvas.width / 2 - 20,
            y: canvas.height - 50,
            width: 40,
            height: 30,
            speed: 6
        };
        
        let obstacles = [];
        let obstacleSpeed = 3;
        let obstacleSpawnRate = 50;
        let frameCount = 0;
        let gameLoopId = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            player.x = canvas.width / 2 - 20;
            obstacles = [];
            frameCount = 0;
            score = 0;
            level = 1;
            obstacleSpeed = 3;
            updateDisplays();
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('saveSection').style.display = 'none';
        }
        
        // –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã
        function startGame() {
            if (!gameRunning) {
                initGame();
                gameRunning = true;
                startBtn.disabled = true;
                startBtn.textContent = '–ò–≥—Ä–∞...';
                
                gameLoopId = requestAnimationFrame(gameLoop);
            }
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (!gameRunning) return;
            
            // –û—á–∏—Å—Ç–∫–∞
            ctx.fillStyle = '#141420';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –ó–≤–µ–∑–¥—ã
            drawStars();
            
            // –ò–≥—Ä–æ–∫
            drawPlayer();
            
            // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            if (frameCount % obstacleSpawnRate === 0) {
                spawnObstacle();
            }
            updateObstacles();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
            if (checkCollisions()) {
                endGame();
                return;
            }
            
            // –£—Ä–æ–≤–µ–Ω—å
            updateLevel();
            
            frameCount++;
            gameLoopId = requestAnimationFrame(gameLoop);
        }
        
        // –ó–≤–µ–∑–¥—ã
        function drawStars() {
            ctx.fillStyle = 'rgba(255,255,255,0.7)';
            for (let i = 0; i < 20; i++) {
                const x = (frameCount + i * 30) % canvas.width;
                const y = (i * 25) % canvas.height;
                ctx.fillRect(x, y, 1, 1);
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–∫–∞
        function drawPlayer() {
            // –ö–æ—Ä–ø—É—Å
            ctx.fillStyle = '#4dabf7';
            ctx.beginPath();
            ctx.moveTo(player.x + player.width/2, player.y);
            ctx.lineTo(player.x, player.y + player.height);
            ctx.lineTo(player.x + player.width, player.y + player.height);
            ctx.closePath();
            ctx.fill();
            
            // –°–≤–µ—Ç
            ctx.fillStyle = '#a5d8ff';
            ctx.beginPath();
            ctx.arc(player.x + player.width/2, player.y + 8, 6, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
        function spawnObstacle() {
            const size = 15 + Math.random() * 20;
            const colors = ['#ff6b6b', '#ff922b', '#40c057', '#339af0'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            obstacles.push({
                x: Math.random() * (canvas.width - size),
                y: -size,
                size: size,
                speed: obstacleSpeed,
                color: color
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
        function updateObstacles() {
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obs = obstacles[i];
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
                ctx.fillStyle = obs.color;
                ctx.beginPath();
                ctx.arc(obs.x + obs.size/2, obs.y + obs.size/2, obs.size/2, 0, Math.PI * 2);
                ctx.fill();
                
                // –î–≤–∏–∂–µ–Ω–∏–µ
                obs.y += obs.speed;
                
                // –£–¥–∞–ª–µ–Ω–∏–µ
                if (obs.y > canvas.height) {
                    obstacles.splice(i, 1);
                    score += 10;
                    updateDisplays();
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
        function checkCollisions() {
            for (let obs of obstacles) {
                const dx = (player.x + player.width/2) - (obs.x + obs.size/2);
                const dy = (player.y + player.height/2) - (obs.y + obs.size/2);
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < (player.width/2 + obs.size/2)) {
                    return true;
                }
            }
            return false;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
        function updateLevel() {
            const newLevel = Math.floor(score / 100) + 1;
            if (newLevel > level) {
                level = newLevel;
                obstacleSpeed = 3 + level * 0.5;
                obstacleSpawnRate = Math.max(25, 50 - level * 3);
                updateDisplays();
            }
        }
        
        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
        function endGame() {
            gameRunning = false;
            cancelAnimationFrame(gameLoopId);
            
            document.getElementById('gameOver').style.display = 'block';
            document.getElementById('finalScore').textContent = score;
            document.getElementById('saveSection').style.display = 'flex';
            
            startBtn.disabled = false;
            startBtn.textContent = '–°–Ω–æ–≤–∞';
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        function moveLeft() {
            if (gameRunning && player.x > 0) {
                player.x -= player.speed;
            }
        }
        
        function moveRight() {
            if (gameRunning && player.x < canvas.width - player.width) {
                player.x += player.speed;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function updateDisplays() {
            document.getElementById('currentScore').textContent = score;
            document.getElementById('level').textContent = level;
            document.getElementById('speed').textContent = obstacleSpeed.toFixed(1);
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function saveScore() {
            const username = document.getElementById('username').value.trim() || '–ò–≥—Ä–æ–∫';
            
            if (tg) {
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram –±–æ—Ç–∞
                tg.sendData(JSON.stringify({
                    action: 'save_score',
                    username: username,
                    score: score,
                    level: level
                }));
                
                alert('–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
            } else {
                alert(`–°—á—ë—Ç: ${score}\n–ò–º—è: ${username}\n(–í Telegram –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ)`);
            }
            
            document.getElementById('saveSection').style.display = 'none';
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
        document.addEventListener('keydown', (e) => {
            if (e.code === 'ArrowLeft') moveLeft();
            if (e.code === 'ArrowRight') moveRight();
            if (e.code === 'Space' && !gameRunning) startGame();
        });
        
        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞
        function resizeCanvas() {
            const container = document.querySelector('.game-section');
            const maxWidth = Math.min(window.innerWidth - 20, 500);
            const aspectRatio = 1.54;
            
            canvas.width = maxWidth;
            canvas.height = maxWidth / aspectRatio;
            
            player.x = canvas.width / 2 - 20;
            player.y = canvas.height - 50;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
    </script>

</body>
</html>
