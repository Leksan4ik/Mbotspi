<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–£–∫–ª–æ–Ω—è–ª–∫–∞</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: radial-gradient(circle at top, #1b0f3b, #070711);
    color:#fff;
    min-height:100vh;
    overflow:hidden;
}

/* ===== HEADER ===== */
.header{
    text-align:center;
    padding:14px 10px;
}
.header h1{
    font-size:1.4em;
    font-weight:800;
    background:linear-gradient(90deg,#ffd43b,#ff922b);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}
.subtitle{
    font-size:.8em;
    color:#d0bfff;
}

/* ===== GAME CARD ===== */
.game-card{
    background:linear-gradient(180deg,#2b1c5a,#1a103b);
    border-radius:20px;
    padding:12px;
    margin:0 10px;
    box-shadow:
        inset 0 1px 0 rgba(255,255,255,.15),
        0 10px 30px rgba(0,0,0,.6);
}

/* ===== CANVAS ===== */
canvas{
    display:block;
    width:100%;
    border-radius:14px;
    background:#0b0b18;
    box-shadow:inset 0 0 20px rgba(0,0,0,.8);
}

/* ===== STATS ===== */
.stats{
    display:flex;
    gap:8px;
    margin-top:10px;
}
.stat{
    flex:1;
    background:linear-gradient(180deg,#3b2b7a,#24175a);
    border-radius:14px;
    padding:8px 6px;
    text-align:center;
    font-weight:700;
    font-size:.85em;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.15);
}
.stat span{
    display:block;
    margin-top:2px;
    color:#ffd43b;
}

/* ===== CONTROLS ===== */
.controls{
    display:flex;
    gap:10px;
    margin-top:12px;
}
.btn{
    flex:1;
    border:none;
    border-radius:16px;
    padding:14px 0;
    font-size:16px;
    font-weight:800;
    cursor:pointer;
    color:#1a1200;
    background:linear-gradient(180deg,#ffe066,#fab005);
    box-shadow:
        0 6px 0 #d18b00,
        0 12px 20px rgba(0,0,0,.4);
    transition:.1s;
}
.btn:active{
    transform:translateY(4px);
    box-shadow:0 2px 0 #d18b00;
}
.btn.start{
    background:linear-gradient(180deg,#69db7c,#38d9a9);
    box-shadow:
        0 6px 0 #2f9e44,
        0 12px 20px rgba(0,0,0,.4);
}
.btn:disabled{
    opacity:0.5;
    cursor:not-allowed;
}
.btn:disabled:active{
    transform:none;
    box-shadow:
        0 6px 0 #d18b00,
        0 12px 20px rgba(0,0,0,.4);
}
.btn.start:disabled{
    box-shadow:
        0 6px 0 #2f9e44,
        0 12px 20px rgba(0,0,0,.4);
}

/* ===== GAME OVER ===== */
.game-over{
    display:none;
    margin-top:10px;
    padding:12px;
    text-align:center;
    border-radius:14px;
    background:linear-gradient(180deg,#5c1a1a,#2b0b0b);
    color:#ffa8a8;
    font-weight:700;
}

/* ===== SAVE ===== */
.save{
    display:none;
    gap:8px;
    margin:10px;
}
.save input{
    flex:1;
    padding:10px;
    border-radius:12px;
    border:none;
    background:#1b143a;
    color:#fff;
}
.save button{
    padding:10px 14px;
    border:none;
    border-radius:12px;
    background:linear-gradient(180deg,#74c0fc,#4dabf7);
    font-weight:700;
}

/* ===== BOTTOM BAR ===== */
.bottom{
    position:fixed;
    bottom:0;left:0;right:0;
    background:linear-gradient(180deg,#1b123f,#0b0620);
    display:flex;
    padding:10px 0;
    border-top:1px solid rgba(255,255,255,.1);
}
.bottom button{
    flex:1;
    background:none;
    border:none;
    color:#c0b3ff;
    font-size:11px;
    padding:8px 0;
    cursor:pointer;
}
.bottom div{
    font-size:18px;
    margin-bottom:4px;
}

/* ===== RESPONSIVE ===== */
@media (max-height: 700px) {
    .header{
        padding:8px 10px;
    }
    .game-card{
        padding:10px;
    }
    canvas{
        height:220px;
    }
    .bottom{
        position:relative;
        margin-top:10px;
        border-top:none;
        border-radius:16px;
        margin:10px;
    }
}
</style>
</head>

<body>

<div class="header">
    <h1>üéÆ –£–∫–ª–æ–Ω—è–ª–∫–∞</h1>
    <div class="subtitle">–ê—Ä–∫–∞–¥–Ω—ã–π —Ä–µ–∂–∏–º</div>
</div>

<div class="game-card">
    <canvas id="gameCanvas"></canvas>

    <div class="stats">
        <div class="stat">üèÜ<span id="currentScore">0</span></div>
        <div class="stat">üéØ<span id="level">1</span></div>
        <div class="stat">‚ö°<span id="speed">3</span></div>
    </div>

    <div class="game-over" id="gameOver">
        üí• –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞<br>
        –°—á—ë—Ç: <span id="finalScore">0</span>
    </div>

    <div class="controls">
        <button class="btn" id="leftBtn" onclick="moveLeft()">‚óÄ</button>
        <button class="btn start" id="startBtn" onclick="startGame()">START</button>
        <button class="btn" id="rightBtn" onclick="moveRight()">‚ñ∂</button>
    </div>
</div>

<div class="save" id="saveSection">
    <input id="username" value="–ò–≥—Ä–æ–∫">
    <button onclick="saveScore()">üíæ</button>
</div>

<div class="bottom">
    <button><div>üéÆ</div>–ò–≥—Ä–∞</button>
    <button><div>üìä</div>–°—Ç–∞—Ç—ã</button>
    <button><div>üèÜ</div>–¢–æ–ø</button>
    <button><div>‚öôÔ∏è</div>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</div>

<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
    const tg = window.Telegram?.WebApp;
    if (tg) {
        tg.expand();
        tg.MainButton.hide();
    }
    
    // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const startBtn = document.getElementById('startBtn');
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ canvas
    function setupCanvas() {
        const container = document.querySelector('.game-card');
        const maxWidth = Math.min(window.innerWidth - 40, 500);
        const aspectRatio = 1.5; // –ò–∑–º–µ–Ω–∏–ª —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω
        
        canvas.width = maxWidth;
        canvas.height = maxWidth / aspectRatio;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–≥—Ä–æ–∫–∞
        player.x = canvas.width / 2 - 20;
        player.y = canvas.height - 50;
    }
    
    let gameRunning = false;
    let score = 0;
    let level = 1;
    let player = {
        x: 0,
        y: 0,
        width: 40,
        height: 30,
        speed: 6
    };
    
    let obstacles = [];
    let obstacleSpeed = 3;
    let obstacleSpawnRate = 50;
    let frameCount = 0;
    let gameLoopId = null;
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    function initGame() {
        player.x = canvas.width / 2 - 20;
        obstacles = [];
        frameCount = 0;
        score = 0;
        level = 1;
        obstacleSpeed = 3;
        updateDisplays();
        document.getElementById('gameOver').style.display = 'none';
        document.getElementById('saveSection').style.display = 'none';
        startBtn.disabled = false;
        startBtn.textContent = 'START';
    }
    
    // –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã
    function startGame() {
        if (!gameRunning) {
            initGame();
            gameRunning = true;
            startBtn.disabled = true;
            startBtn.textContent = '–ò–ì–†–ê...';
            leftBtn.disabled = false;
            rightBtn.disabled = false;
            
            gameLoopId = requestAnimationFrame(gameLoop);
        }
    }
    
    // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
    function gameLoop() {
        if (!gameRunning) return;
        
        // –û—á–∏—Å—Ç–∫–∞ canvas
        ctx.fillStyle = '#0b0b18';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // –ó–≤–µ–∑–¥–Ω—ã–π —Ñ–æ–Ω
        drawStars();
        
        // –ò–≥—Ä–æ–∫
        drawPlayer();
        
        // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
        if (frameCount % obstacleSpawnRate === 0) {
            spawnObstacle();
        }
        updateObstacles();
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
        if (checkCollisions()) {
            endGame();
            return;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
        updateLevel();
        
        frameCount++;
        gameLoopId = requestAnimationFrame(gameLoop);
    }
    
    // –ó–≤–µ–∑–¥–Ω—ã–π —Ñ–æ–Ω
    function drawStars() {
        ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
        for (let i = 0; i < 25; i++) {
            const x = (frameCount * 0.5 + i * 50) % canvas.width;
            const y = (i * 20) % canvas.height;
            const size = Math.random() * 2;
            ctx.fillRect(x, y, size, size);
        }
    }
    
    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–∫–∞
    function drawPlayer() {
        // –ö–æ—Ä–ø—É—Å –∫–æ—Ä–∞–±–ª—è
        ctx.fillStyle = '#4dabf7';
        ctx.beginPath();
        ctx.moveTo(player.x + player.width/2, player.y);
        ctx.lineTo(player.x, player.y + player.height);
        ctx.lineTo(player.x + player.width, player.y + player.height);
        ctx.closePath();
        ctx.fill();
        
        // –ö–∞–±–∏–Ω–∞
        ctx.fillStyle = '#a5d8ff';
        ctx.beginPath();
        ctx.arc(player.x + player.width/2, player.y + 10, 8, 0, Math.PI * 2);
        ctx.fill();
        
        // –î–≤–∏–≥–∞—Ç–µ–ª–∏
        ctx.fillStyle = '#ff6b6b';
        const flameHeight = 10 + Math.sin(frameCount * 0.2) * 3;
        ctx.fillRect(player.x + 10, player.y + player.height, 8, flameHeight);
        ctx.fillRect(player.x + player.width - 18, player.y + player.height, 8, flameHeight);
    }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
    function spawnObstacle() {
        const size = 15 + Math.random() * 20;
        const colors = ['#ff6b6b', '#ff922b', '#40c057', '#339af0'];
        const color = colors[Math.floor(Math.random() * colors.length)];
        
        obstacles.push({
            x: Math.random() * (canvas.width - size),
            y: -size,
            size: size,
            speed: obstacleSpeed,
            color: color,
            rotation: Math.random() * Math.PI * 2,
            rotationSpeed: (Math.random() - 0.5) * 0.05
        });
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
    function updateObstacles() {
        for (let i = obstacles.length - 1; i >= 0; i--) {
            const obs = obstacles[i];
            
            // –í—Ä–∞—â–µ–Ω–∏–µ
            obs.rotation += obs.rotationSpeed;
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å –≤—Ä–∞—â–µ–Ω–∏–µ–º
            ctx.save();
            ctx.translate(obs.x + obs.size/2, obs.y + obs.size/2);
            ctx.rotate(obs.rotation);
            
            ctx.fillStyle = obs.color;
            ctx.beginPath();
            ctx.arc(0, 0, obs.size/2, 0, Math.PI * 2);
            ctx.fill();
            
            // –î–µ—Ç–∞–ª–∏ –Ω–∞ –∞—Å—Ç–µ—Ä–æ–∏–¥–µ
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.beginPath();
            ctx.arc(obs.size/4, obs.size/4, obs.size/6, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.restore();
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –≤–Ω–∏–∑
            obs.y += obs.speed;
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –≤—ã—à–µ–¥—à–∏—Ö –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤
            if (obs.y > canvas.height) {
                obstacles.splice(i, 1);
                score += 10;
                updateDisplays();
                
                // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –æ—á–∫–æ–≤
                canvas.style.boxShadow = '0 0 15px #ffd43b';
                setTimeout(() => {
                    canvas.style.boxShadow = 'inset 0 0 20px rgba(0,0,0,.8)';
                }, 100);
            }
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
    function checkCollisions() {
        for (let obs of obstacles) {
            const dx = (player.x + player.width/2) - (obs.x + obs.size/2);
            const dy = (player.y + player.height/2) - (obs.y + obs.size/2);
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance < (player.width/2 + obs.size/2)) {
                return true;
            }
        }
        return false;
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
    function updateLevel() {
        const newLevel = Math.floor(score / 100) + 1;
        if (newLevel > level) {
            level = newLevel;
            obstacleSpeed = 3 + level * 0.5;
            obstacleSpawnRate = Math.max(25, 50 - level * 3);
            updateDisplays();
            
            // –≠—Ñ—Ñ–µ–∫—Ç –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
            const gameCard = document.querySelector('.game-card');
            gameCard.style.boxShadow = 'inset 0 1px 0 rgba(255,255,255,.15), 0 0 30px #38d9a9';
            setTimeout(() => {
                gameCard.style.boxShadow = 'inset 0 1px 0 rgba(255,255,255,.15), 0 10px 30px rgba(0,0,0,.6)';
            }, 300);
        }
    }
    
    // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
    function endGame() {
        gameRunning = false;
        cancelAnimationFrame(gameLoopId);
        
        document.getElementById('gameOver').style.display = 'block';
        document.getElementById('finalScore').textContent = score;
        document.getElementById('saveSection').style.display = 'flex';
        
        startBtn.disabled = false;
        startBtn.textContent = '–°–ù–û–í–ê';
        leftBtn.disabled = true;
        rightBtn.disabled = true;
        
        // –≠—Ñ—Ñ–µ–∫—Ç –≤–∑—Ä—ã–≤–∞
        ctx.fillStyle = '#ff6b6b';
        for (let i = 0; i < 15; i++) {
            const angle = Math.random() * Math.PI * 2;
            const radius = Math.random() * 25;
            const x = player.x + player.width/2 + Math.cos(angle) * radius;
            const y = player.y + player.height/2 + Math.sin(angle) * radius;
            const size = Math.random() * 8 + 4;
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.fill();
        }
    }
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    function moveLeft() {
        if (gameRunning && player.x > 0) {
            player.x -= player.speed;
            // –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
            leftBtn.style.transform = 'translateY(4px)';
            leftBtn.style.boxShadow = '0 2px 0 #d18b00';
            setTimeout(() => {
                leftBtn.style.transform = '';
                leftBtn.style.boxShadow = '0 6px 0 #d18b00, 0 12px 20px rgba(0,0,0,.4)';
            }, 100);
        }
    }
    
    function moveRight() {
        if (gameRunning && player.x < canvas.width - player.width) {
            player.x += player.speed;
            // –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
            rightBtn.style.transform = 'translateY(4px)';
            rightBtn.style.boxShadow = '0 2px 0 #d18b00';
            setTimeout(() => {
                rightBtn.style.transform = '';
                rightBtn.style.boxShadow = '0 6px 0 #d18b00, 0 12px 20px rgba(0,0,0,.4)';
            }, 100);
        }
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    function updateDisplays() {
        document.getElementById('currentScore').textContent = score;
        document.getElementById('level').textContent = level;
        document.getElementById('speed').textContent = obstacleSpeed.toFixed(1);
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    function saveScore() {
        const username = document.getElementById('username').value.trim() || '–ò–≥—Ä–æ–∫';
        
        if (tg) {
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram –±–æ—Ç–∞
            tg.sendData(JSON.stringify({
                action: 'save_score',
                username: username,
                score: score,
                level: level
            }));
            
            // –≠—Ñ—Ñ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            const saveBtn = document.querySelector('.save button');
            saveBtn.style.background = 'linear-gradient(180deg,#40c057,#2b8a3e)';
            saveBtn.textContent = '‚úì';
            setTimeout(() => {
                saveBtn.style.background = 'linear-gradient(180deg,#74c0fc,#4dabf7)';
                saveBtn.textContent = 'üíæ';
            }, 1000);
        } else {
            alert(`üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!\n\n–ò–≥—Ä–æ–∫: ${username}\n–°—á—ë—Ç: ${score}\n–£—Ä–æ–≤–µ–Ω—å: ${level}`);
        }
        
        document.getElementById('saveSection').style.display = 'none';
    }
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    document.addEventListener('keydown', (e) => {
        if (e.code === 'ArrowLeft') moveLeft();
        if (e.code === 'ArrowRight') moveRight();
        if (e.code === 'Space' && !gameRunning) startGame();
    });
    
    // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Ä–∞–∑–º–µ—Ä–∞–º —ç–∫—Ä–∞–Ω–∞
    window.addEventListener('resize', setupCanvas);
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('DOMContentLoaded', () => {
        setupCanvas();
        initGame();
        
        console.log('üéÆ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: —Å—Ç—Ä–µ–ª–∫–∏ ‚Üê ‚Üí –∏–ª–∏ –∫–Ω–æ–ø–∫–∏');
    });
</script>

</body>
</html>
